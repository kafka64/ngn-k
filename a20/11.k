#!../k
a:0:"i/11"
N:*/n:(#a;#*a);a:,/a;b:(~"."=a),0i;c:("#"=a),0i;d:+D:(1-!3 3)_'4;v:{&/(x<0)<x<n}
f:{[t;h]+/{[t;h;x]b*(~s+x)|x*t>s:+/x h}[t;h]/c}
f[4;,'[;N](N*~u)+(n/h)*u:&/(-1_b)*/:/:u:>/(n;0)>\:h:D+\:'!n]
f[5;+,[;N]@{x{$[~&/(n>x)>0>x+:y;N;b@n/x;n/x;o[x]y]}/:d}'+!n]
