#include"a.h" // ngn/k, (c) 2019-2023 ngn, GNU AGPLv3 - https://codeberg.org/ngn/k/raw/branch/master/LICENSE
S A1(sam,x)V_;T_;U _K(A x/*0*/)_(X(R2(tu,tw,1)Rv(2)Rx(x>>48&15)Ropqr(xk))0)
X1(mkn,RmMA(e1f(mkn,x))Rt(x(_R(cn[xt])))R_(x(rsz(xN,_R(cn[xt])))))
A1(iei,/*0*/0x2332211004>>(xv*(xtv&&xv<10u)<<2)&15)
Y2(iex,/*01*/RmMA(r2f(iex,x,y))RT_A(rsz(yN,iex(x,fir(y))))Rs(as(0))Rc(ac("\0\1\x7f\x80 "[iei(x)]))Rf(y(af(A(0.,1.,WF,-WF,NF)[iei(x)])))R_(y(az(G(0ll,1,WL,-WL,NL)[iei(x)]))))
A2(ie,/*00*/x==CAT?emp(yt):iex(x,fir(yR)))
AX(prj,XmMA(x8(a,n))U k=MAX(n,xK);i(n,k-=a[i]!=GAP)x=(xtp?val:aA1)(xR);I i=0,j=1;W(i<n&&j<xn,I(xA[j]==GAP,xA[j]=a[i++])j++)W(i<n,PSH(x,a[i++]))P(xn>9,ez(x))AT(tp,AK(k,x)))
S A iM(A x,L i)_(Q(xtM);A y=xy,z=aA(yn);Q(ytA);j(zn|!zn,zA[j]=io(yA[j],i))am(_R(xx),sqz(z)))
A ii(A x/*0*/,U i)_(X(RA(_R(xa))RC(ac(xc))RG(ai(xg))RH(ai(xh))RI(ai(xi))RL(al(xl))RF(af(xf))RS(as(xi))Rm(ii(xy,i))RM(iM(x,i))RE(az(*xL+i))RB(ai(xG[i>>3]>>(i&7)&1))R_(xR))0)
A io(A x/*0*/,L i)_(X(RE(i<(W)(xL[1]-*xL)?az(*xL+i):_R(cn[tl]))RT_E(i<(W)xn?ii(x,i):xn?mkn(ii(x,0)):xtA?_R(xx):_R(cn[xt]))Rt(xR)Rm(io(xy,i))RM(iM(x,i)))0)
A1(fir,x(io(x,0)))A1(las,x(io(x,xN-1)))
SN U maxfU(O U*a,U n)_(U v=0;i(n,v=MAX(v,a[i]))v)
#define ambcn O V*RES a,U m,O U*RES b,V*RES c,U n
SN V iG(ambcn){O G*p=a;G*r=c;i(n,*r++=p[*b++])}
SN V iH(ambcn){O H*p=a;H*r=c;i(n,*r++=p[*b++])}
SN V iI(ambcn){O I*p=a;I*r=c;i(n,*r++=p[*b++])}
SN V iC(ambcn){O C*p=a;C*r=c;i(n+31&-32,*r++=b[i]<m?p[b[i]]:32)}
SN V iS(ambcn){O I*p=a;I*r=c;i(n+7&-8,*r++=b[i]<m?p[b[i]]: 0)}
SN V oG(ambcn){O G*p=a;L*r=c;i(n+3&-4,*r++=b[i]<m?p[b[i]]:NL)}
SN V oH(ambcn){O H*p=a;L*r=c;i(n+3&-4,*r++=b[i]<m?p[b[i]]:NL)}
SN V oI(ambcn){O I*p=a;L*r=c;i(n+3&-4,*r++=b[i]<m?p[b[i]]:NL)}
SN V o8(ambcn,L v){O L*p=a;L*r=c;i(n+3&-4,*r++=b[i]<m?p[b[i]]:v)}
SN V oL(ambcn){o8(a,m,b,c,n,NL);}
SN V oF(ambcn){o8(a,m,b,c,n,NFL);}
A2(i1,/*01*/P(y==GAP||y==au,xR)
 X(Rt(y(xR))
   RE(x=gZ(xR);x(i1(x,y)))
   Rm(i1(xy,N(fnd(xx,y))))
   RM(Y(RsS(x=flp(xR);x(i1(x,y)))RA(r2(AP1,x,y))RmM(A z=kv(&y);am(y,Ny(i1(x,z))))R_(B d=ytmt;y=N(l2f(i1,xy,y));(d?am:aM)(_R(xx),y)))0)
   R_(Y(Rilc(io(x,gl(y)))
        RmM(A z=kv(&y);am(y,Ny(i1(x,z))))
        RA(r2(AP1,x,y))
        RE(L i=*yL,j=yL[1];P(0<=i&&i<j&&j<xN,y(0);slc(x,i,j))i1(x,gZ(y)))
        R4(tB,tG,tH,tC,i1(x,cI(y)))
        R_(et(y))
        RL(U m=xn;A z=aI(yn);My(i(yn+3&-4,L v=yl;zi=v|-(v!=(I)v)))i1(x,z))
        RI(U n=yn;
         X(RA(A z=aA(n);i(n|!n,za=io(x,yi))y(0);I(!zn,zx=mkn(zx))sqz(z))
           RB(x=cG(xR);x(i1(x,y)))
           R_(C t=xt;B k=t-tG<3u&&maxfU(yV,yn)>=xn;A z=an(n,k?tL:t);My(G(&iG,iH,iI,oL,oF,iC,iS,oG,oH,oI)[7*k+t-tG](xV,xn,yV,zV,n))z))0))0))0)
S A3(i2,/*001*/C b=ytT||y==GAP||y==au;x=Nz(i1(x,yR));P(!b,x(x1(z)))x(l2f(dot,x,aA1(z))))
S AX(i8,A y=*a;P(n==1,i1(x,y))P(n==2,y(_2(x,y,a[1])))a++;n--;C b=ytT||y==GAP||y==au;x=i1(x,y);P(!x,mrn(n,a);x)P(!b,x(i8(x,a,n)))x(l2f(dot,x,aV(tA,n,a))))
L iw(A x/*0*/,U w,L i)_(S4(w,_(xg),_(xh),_(xi),_(xl))0)
S A1(qa,A y=emp(tA);Q*p=argv;W(*p,PSH(y,aCz(*p++)))y(y1(x)))
S A1(qe,A y=emp(tS),z=emp(tA);Q*e=env;W(*e,Q p=*e++,q=strchrnul(p,'=');PSH(y,cS(aCm(p,q)));PSH(z,aCz(q+!!*q)))y=am(y,z);x-au?x(x1(y)):y)
S A1(qx,exit(xtz?gl(x):1);0)
S X1(qjs,RC(C b[4096];U n=js_eval(xC,xn,b,SZ b);x(0);aCn(b,n))RA(e1f(qjs,x))R_(et(x)))
S X1(qp,RC(x=str0(x);Q s=xC;x(pk(&s,0)))R_(et(x)))
S A1(qt,x(al(now())))
S A1(qfb,P(!xtC,et(x))P(xn-8,el(x))x=rev(x);x(aV(tf,1,xV)))//float from bits
SN AX(ext,P(n-xK,er8(a,n))V*f=(V*)(x&-1ull>>16);SW(n,R(1,((A1*)f)(a[0]))R(2,((A2*)f)(a[0],a[1]))R(3,((A3*)f)(a[0],a[1],a[2]))R(4,((A4*)f)(a[0],a[1],a[2],a[3]))R_(en8(a,n)))0)
SN A sym1(I v,A x)_(S O C s[][4]={"k","j","p","t","x","hex","err","argv","env","exit","js","pri","prng","sin","cos","exp","ln","fb"};
 G(&kst,js1,qp,qt,frk,hex,err,qa,qe,qx,qjs,qpri,prng,ksin,kcos,kexp,klog,qfb,ed)[fI((V*)s,L(s),v)](x))
A2(_1,/*01*/P(!xtt,i1(x,y))U k=xK;P(1<k,k==2&&!xtp?prj(x,A(y,GAP),2):prj(x,&y,1))
 X(Ro(run(x,&y,1))Rp(P(k>7,er(y))I m=xn-1,j=0;Ab8;i(m,b[i]=xA[i+1]==GAP&&!j?j++,y:_R(xA[i+1]))I l=MAX(0,1-j);MC(b+m,&y,8*l);_8(xx,b,m+l))
  Rq(_1(xx,N(_1(xy,y))))Rr(w1(xE,xx,y))Rs(sym1(xv,y))Ru(v1[xv](y))Rw(AK(xv-1<3u&&yK==2?1:ytU?yK:1,AW(xv,aV(tr,1,&y))))Rx(ext(x,&y,1))R_(et(y)))0)
A3(_2,/*001*/P(!xtt,i2(x,y,z))A a[]={y,z};U k=xK;P(2<k,yR;prj(x,a,2))
 X(Ro(yR;run(x,a,2))Rp(P(k>6,er(z))yR;I m=xn-1,j=0;Ab8;i(m,b[i]=xA[i+1]==GAP&&j<2?a[j++]:_R(xA[i+1]))I l=MAX(0,2-j);MC(b+m,a+j,8*l);_8(xx,b,m+l))
  Rq(_1(xx,N(_2(xy,y,z))))Rr(z(w2(xE,xx,yR,z)))Rv(v2[xv](y,z))Rw(xv?en(x):AK(zK,AT(tq,aA2(yR,z))))Rx(ext(x,A(yR,z),2))R_(et(z)))0)
AX(_8,/*01..1*/Q(n)P(n==1,x1(*a))P(n==2&&!xtp,A y=*a;y(x2(y,a[1])))P(!xtt,i8(x,a,n))U k=xK;P(n<k,prj(x,a,n))
 X(Ro(run(x,a,n))Rp(P(k+n>8,er8(a,n))I m=xn-1,j=0;Ab8;i(m,b[i]=xA[i+1]==GAP&&j<n?a[j++]:_R(xA[i+1]))I l=MAX(0,n-j);MC(b+m,a+j,8*l);_8(xx,b,m+l))
   Rq(_1(xx,N(_8(xy,a,n))))Rr(w8(xE,xx,a,n))Rv(x=v8[xv](a,n);mrn(n-1,a+1);x)Rx(ext(x,a,n))R_(et8(a,n)))0)
A1(jS,cS(jc('.',str(x))))//join symbols with "."
X1(val,RA(P(!xn,x)P(xn==1,fir(x))P(xn>9,ez(x))x=mut(x);A y=_8(xx,&xy,xn-1);AN(1,x);x(y))RmM(x(_R(xy)))RE(gZ(x))RC(x=str0(x);x(evs(xV,0)))Rc(val(enl(x)))RsS(gg(x))
 Ropq(AT(tA,mut(x)))Rr(cat10(AT(tA,mut(x)),aw+xE))Ruvw(ai(xv))R_(x))
A2(dot,/*01*/Ym(et(y))U n=yN;P(!n,y(xR))P(n>8,ez(y))y=mRa(N(blw(y)));y(x8(yA,n)))
S U knd(A x/*0*/)_(X(Ril(ti)REBGHIL(tI)R_(xt))0)
S A set(A x,L i,A y/*1i1*/)_(Q(xr==1);
 X(RA(A z=xa;xa=z(y);ytt&&!ytU?sqz(x):x)
   RM(A z=kv(&x);z=mut(z);Q(ztA);I(ytT&&yN-zn,x(y(el(z))))I j=i;i(zn,za=set(mut(za),j,ii(y,i));P(!za,za=au;x(y(z(0)))))y(aM(x,z)))
   RB(set(cG(x),i,y))
   R_(P(knd(x)-knd(y)-tC+tc,set(blw(x),i,y))I(xtZ,N(sup(&x,&y)))C w=xw-3;!w?xg=yv:w==1?xh=yv:w==2?xi=yv:(xl=gl(y));x))0)
AA(a8,/*10..0*/A x=*a,y=a[1];
 X(RE(Ab8;*b=gZ(x);MC(b+1,a+1,n-1<<3);a8(b,n))
   RT_E(P(y==au,mRn(n-2,a+2);Ab8;*b=a[2];b[1]=x;MC(b+2,a+3,n-3<<3);e8(AP1,b,n-1))
    Yzc(L i=gl_(y);P(i>=(W)xn,ei(x))x=mut(x);Ab8;*b=ii(x,i);MC(b+1,a+3,n-3<<3);mRn(n-3,b+1);A z=a[2];set(x,i,Nx(z8(b,n-2))))
    I(ytZC&&n==4,A z=a[2],u=a[3];P(xtZ&&ztv&&utzZ&&(0xcf&1<<zv),ara(x,y,z,u))P(xtC&&z==av&&utcC,cC(N(ara(x,y,z,u)))))Yt(et(x))mRn(n-1,a+1);f8(AP1,a,n))
   Rm(A z=Nx(fnd(xx,yR));ZT(z(0);mRn(n-1,a+1);f8(AP1,a,n))x=mut(x);I(ztl,z=mut(z);i(zN,I(zl==NL,zl=xN;PSH(xx,ztt?yR:ii(y,i));PSH(xy,ie(a[2],xy)))))
    Ab8;*b=xy;b[1]=z;MC(b+2,a+2,n-2<<3);xy=au;xy=Nx(z(a8(b,n)));x)
   RM(Ab8;YsS(*b=flp(x);MC(b+1,a+1,n-1<<3);flp(N(a8(b,n))))i(n,A x=a[i];b[i]=xtM?flp(xR):xR;Q(b[i]))flp(N(x(e8(AP1,b,n)))))
   RU(mRn(n-1,a+1);x(x8(a+1,n-1)))
   R_(et(x)))0)
S A3(a3,/*100*/a8(A(x,y,z),3))
A4(a4,/*1000*/a8(A(x,y,z,u),4))
S A a5(A x,A y,A z,A u,A v/*10000*/)_(a8(A(x,y,z,u,v),5))
S A3(d3,/*100*/U m=yN;P(y==au||!m,z1(x))P(m==1,y=fir(yR);y(a3(x,y,z)))A u=prj(DOT,(A[]){GAP,drp(1,yR)},2);y=fir(yR);y(u(a4(x,y,u,z))))
A4(d4,/*1000*/U m=yN;P(y==au||!m,x(z2(x,uR)))P(m==1,y=fir(yR);y(a4(x,y,z,u)))A v=prj(DOT,(A[]){GAP,drp(1,yR)},2);y=fir(yR);A r=y(a5(x,y,v,z,u));mr(v);r)
S AA(d8_,/*10..0*/A x=*a,y=a[1],z=a[2];P(n==4,d4(x,y,z,a[3]))P(n==3,d3(x,y,z))en(x))
AA(d8,/*10..0*/A x=*a;
 X(RsS(A*p=gp(x);I(!*p,*p=au)Ab8;*b=*p;MC(b+1,a+1,n-1<<3);*p=au;*p=_R(N(d8_(b,n))))
   RU(n==3?try(x,a[1],a[2]):er(x))
   R_(d8_(a,n)))0)
SN A ki(A*p,Q s)_(*p=evs(s,0);I(!*p,die(s))PSH(cns,*p))
A k1(A*p,Q s,A x)_(I(!*p,ki(p,s))_1(*p,x))
A k2(A*p,Q s,A x,A y)_(I(!*p,ki(p,s))_2(*p,x,y))
A k8(A*p,Q s,O A*a,U n)_(I(!*p,ki(p,s))n?_8(*p,a,n):*p)
AA(no8,/*10..0*/en(*a))
