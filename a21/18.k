#!../k
e:{(v;d):x;$[^i:*&0&':5=d;x;(,/@[;2;:;0]@[;1 3;+;v 2]@v:(0,(#v)&0|i+-2 -1 1 2)_v;,/@[;1;-1+*:](0,(#d)&0|i+-1 1)_d)]} /explode
s:{(v;d):x;$[^i:*&9<v;x;(,/@[;1;-2!0 1+*:](0,i+!2)_v;,/@[;1;1+2#](0,i+!2)_d)]} /split
a:(s@e/)/0 1+,' /add
m:{(v;d):x;+/v*(+*\3-2\-1+\16 8 4 2 1@d)@'d-1} /magnitude
D:{$[x~*x;0;1+,/o'x]} /depths
x:{(,//x;D x)}'_`j?'0:"i/18" /input
m@a/x /part1
|/(m@a/)'+x@!2##x /part2
