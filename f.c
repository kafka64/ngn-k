#include"a.h" // ngn/k, (c) 2019-2023 ngn, GNU AGPLv3 - https://codeberg.org/ngn/k/raw/branch/master/LICENSE
I rnk(Ax/*0*/)_(X(RA(Iv=rnk(xx);P(v<0,v)i(xn,P(v-rnk(xa),-1))v+1)RmM(rnk(xy))RT_A(1)R_(0))0)//-1 for mixed rank
I urnk(Ax/*0*/)_(X(RA(urnk(xx)+1)RmM(urnk(xy))RT_A(1)R_(0))0)//assuming unirank
S L fB(OV*p,Nn,Lv)_(O B*a=p,q=v;P(v-q,NL)Ii=0,g=HD/SZ(*a),f=0;W(i<n&&!f,j(g,f|=a[i++]==q))i-=g;j(g,B(a[i]==q)i++)i<n?i:NL)
S L fH(OV*p,Nn,Lv)_(O H*a=p,q=v;P(v-q,NL)Ii=0,g=HD/SZ(*a),f=0;W(i<n&&!f,j(g,f|=a[i++]==q))i-=g;j(g,B(a[i]==q)i++)i<n?i:NL)
  L fI(OV*p,Nn,Lv)_(O I*a=p,q=v;P(v-q,NL)Ii=0,g=HD/SZ(*a),f=0;W(i<n&&!f,j(g,f|=a[i++]==q))i-=g;j(g,B(a[i]==q)i++)i<n?i:NL)
  L fL(OV*p,Nn,Lv)_(O L*a=p,q=v;P(v-q,NL)Ii=0,g=HD/SZ(*a),f=0;W(i<n&&!f,j(g,f|=a[i++]==q))i-=g;j(g,B(a[i]==q)i++)i<n?i:NL)
S A1(fN,Ay=_R(cn[tl]);x(xtt?y:rsz(xN,y)))
S A1(fBN,Q(xtB)Bv=0;i(xn,v|=xb)P(!(v>> 7&1),x)Ay=aL(xn);xe(i(xn,yl=xb<0?NL:xb)y))
S A1(fHN,Q(xtH)Hv=0;i(xn,v|=xb)P(!(v>>15&1),x)Ay=aL(xn);xe(i(xn,yl=xh<0?NL:xh)y))
S A1(fIN,Q(xtI)Iv=0;i(xn,v|=xb)P(!(v>>31&1),x)Ay=aL(xn);xe(i(xn,yl=xi<0?NL:xi)y))
S L t[256];
S X1(fndBx,RmMA(e1f(fndBx,x))Rzc(Lv=gl(x);az(v==(C)v?t[(UC)v]:NL))RE(fndBx(gZ(x)))R_(fN(x))
 RZC_(Nm=xn;Az=aL(m);xe(S4(xw,i(m,zl=t[(UC)xc]),i(m,Hv=xh;zl=v==(C)v?t[(UC)v]:NL),i(m,Iv=xi;zl=v==(C)v?t[(UC)v]:NL),i(m,Lv=xl;zl=v==(C)v?t[(UC)v]:NL))z)))
S A fndB(UC*a,Nn,Ax/*1*/)_(i(256,t[i]=NL)Li=n-1;W(i>=0,t[a[i]]=i;i--)fndBx(x))
S A2(fndH,K2("{a:&/x;b:1+|/x;@[(b-a)#0N;|x-a;:;|!#x]y-a}",x,y))
A2(fndA,/*01*/Ik=urnk(x),l=urnk(y);P(k<l+1,r2f(fnd,x,y))P(k>l+1,er1(y))
 X(RA(i(xn,P(mtc_(xa,y),y(az(i))))y(az(NL)))
   R_(i(xN,Az=ii(x,i);Im=mtc_(z,y);z(0);P(m,y(az(i))))y(az(NL))))0)
X2(fnd,/*01*/
 R_(et1(y))
 Rm(i1(xx,N(fnd(xy,y))))
 RM(en1(y))
 RA(fndA(x,y))
 RE(x=gZ(xR);x(fnd(x,y)))
 RBC(fndB(xV,xn,y))
 R5(tH,tI,tL,tF,tS,
  YmMA(fndA(x,y))
  YE(fnd(x,gZ(y)))
  P(xt==TT[yt]||xtZ&&ytzZ,
   P(xw==1&&xn>128&&yN>128,fndH(x,y))
   TY(fB)*f=A(&fB,fH,fI,fL)[xw];Yt(az(f(xV,xn,gl(y))))
   Nm=xn,n=yn;Az=aL(n);ye(S4(yw,i(n,zl=f(xV,m,yb)),i(n,zl=f(xV,m,yh)),i(n,zl=f(xV,m,yi)),i(n,zl=f(xV,m,yl)))z))
  fN(y)))
X2(que,/*01*/Rs(S O C s[][4]={"","j","hex"};Li=fI(s,L(s),xv);A(&des,js0,unh,ed1)[i<0?L(s):i](y))Rz(rnd(gl_(x),y))R_(fnd(x,y)))
