#!../../k
a:0:"i/16"
n:#a
s:n,n,4
D:4':-1 0 1 0 -1
T:".\\/|-"!(!0),/:/:(0 1 2 3;3 2 1 0;1 0 3 2;(0;0 2;2;0 2);(1 3;1;1 3;3))

/step
f:{(i;j;d):s\x
   t:T[a[i]@'j]@'d
   i1:,/i+D[0]t
   j1:,/j+D[1]t
   d1:,/t
   w:&&/~(0;n)'(i1;j1)
   s/(i1;j1;d1)@\:w}

/number of energized cells if starting from x
e:{+/|/+0N 4#*|{(x;v):x;v[x]:1;x:(v@)_f x;(x;v)}/(x;&*/s)}

e@,s/0 0 1 /1
|/e','s/+,/+'((n-1;!n;0);(!n;0;1);(0;!n;2);(!n;n-1;3)) /2
