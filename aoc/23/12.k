#!../../k
x:@[;1;.:]'" "\'0:"i/12"

f:{k:100/(#x;#y)
   :h[k]: :[~^v:h k;v
     (#x)<-1+/1+y;0
     (+/"#"=x)>+/y;0
     ~#x;~#y
     +/(:[|/".?"=*x;o[1_x;y];0]
        :[(&/|/"#?"=\:x@!*y)&(1=#y)||/".?"=x@*y;o[((~1=#y)+*y)_x;1_y];0])]}

g:{h::(!0)!!0;f[x;y]}

+/g.'x                      /1
+/g.'{("?"/5#,x;,/5#,y)}.'x /2
