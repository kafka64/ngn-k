#!../../k
f:{(i;j):#'(x;y)
 :T[i;j]: :[-1<v:T[i;j];v
            ~j;~+/"#"=x
            i<-1+/1+y;0
            +/(o[-1_x;y]*|/".?"=*|x
               o[(-k)_x;-1_y]*&/|/#[-k;x]=/:"#.?"2,,~!k:1+*|y)]}

g:{x:".",x
   T::(1+#x;1+#y)#-1
   f[x;y]}

x:@[;1;.:]'" "\'0:"i/12"
+/g.'x                     /1
+/g.'{("?"/;,/)@'5#','x}'x /2
