#!../../k
x:2!0:"i/23"
D:((-1 0;-1 -1;-1 1)
   (1 0;1 -1;1 1)
   (0 -1;-1 -1;1 -1)
   (0 1;-1 1;1 1))
w:4{+|0,x}/ /wrap
T:4{+|(+/&\~|/'x)_x}/ /trim

f:{x:w x
   DD:D@4!y+!4
   h:&/''~0^x./:/:/:DD+\:\:/:e:+&x
   i:*'(1=#:')#.=E:e+d:(~&/'h)*(|/'h)*(*'DD)@*'&'h
   e[i]:E i
   T@(0&x).[;;:;1]/e}

+//~x f/!10 /part1

/part2(slow)
i:-1
{f[x;i+:1]}/T x;
1+i
