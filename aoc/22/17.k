#!/usr/bin/env k
x:">>><<><>><<<>><>>><<<>>><<<><<<>><>><<>>"
x:*0:"i/17"
X:1-2*"<"=x

/rocks: - + J I O
R:((0 0 0 0;0 1 2 3)
   (-2 -1 -1 -1 0;1 0 1 2 1)
   (-2 -1 0 0 0;2 2 0 1 2)
   (-3 -2 -1 0;0 0 0 0)
   (-1 -1 0 0;0 1 0 1))

a:10000 7#0;t:0;p:(-4+#a;2);n:0 /t:type and p:position of falling rock, n:number of fallen rocks

{x+:1;x*:x<#X
 q:p+0,X x;$[&/~a./:+q+R t;p::q;]
 q:p+1 0;$[&/~a./:+q+R t;p::q
  [.[`a;;:;1]'+p+R t;n+:1;t+:1;t*:t<#R;p::(-4+*>|/'a;2)]]
 (-1;x)n<2022}/-1;
+/|/'a
